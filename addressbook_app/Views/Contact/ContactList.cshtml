@using System.Data
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <i class="icon-home"></i>
            <a asp-controller="Home" asp-action="Index">Home</a>
            <i class="fa fa-arrow-right"></i>
        </li>
        <li>
            <span>Contact List</span>
        </li>
    </ul>
</div>

@if (TempData["ErrorMsg"] != null)
{
    <div id="customToast" class="custom-toast">
        <span>@TempData["ErrorMsg"]</span>
        <button class="close-toast" onclick="closeToast()">×</button>
    </div>
}

@if (TempData["SuccessMsg"] != null)
{
    <div id="customToast1" class="custom-toast1">
        <span>@TempData["SuccessMsg"]</span>
        <button class="close-toast1" onclick="closeToast1()">×</button>
    </div>
}

<div class="portlet light portlet-fit bordered" style="margin-top:10px">
    <div class="portlet-title d-flex justify-content-between">
        <div class="caption">
            <i class="icon-settings"></i>
            <span class="caption-subject sbold uppercase">Contact List</span>
        </div>
        <div class="actions">
            <div class="btn-group btn-group-devided">
                <a asp-controller="Contact" asp-action="ContactForm" class="btn green">
                    <i class="fa fa-plus"></i>
                    Add New
                </a>
                <a asp-controller="Contact" asp-action="ExportToExcel" class="btn green">
                    Export to Excel
                </a>
            </div>
        </div>
    </div>
    <div class="portlet-body">
        <div class="table-toolbar">
            <div class="form-group col-md-3">
                <input type="text" id="searchBox" class="form-control" placeholder="Search Contact...">
            </div>
        </div>
        <!-- Scrollable container for the table -->
        <div class="table-responsive">
            <table class="table table-striped table-hover table-bordered" id="sample_editable_1">
                <thead>
                    <tr>
                        <th>Country Name</th>
                        <th>State Name</th>
                        <th>City Name</th>
                        <th>Name</th>
                        <th>Gender</th>
                        <th>Mobile No</th>
                        <th>WhatsApp No</th>
                        <th>Email ID</th>
                        <th>Address</th>
                        <th>Date of Birth</th>
                        <th>Facebook ID</th>
                        <th>Instagram ID</th>
                        <th>Blood Group</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (DataRow dataRow in Model.Rows)
                    {
                        <tr>
                            <td>@dataRow["CountryName"]</td>
                            <td>@dataRow["StateName"]</td>
                            <td>@dataRow["CityName"]</td>
                            <td>@dataRow["Name"]</td>
                            <td>@dataRow["Gender"]</td>
                            <td>@dataRow["MobileNo"]</td>
                            <td>@dataRow["WhatsAppNo"]</td>
                            <td>@dataRow["EmailID"]</td>
                            <td>@dataRow["Address"]</td>
                            <td>@Convert.ToDateTime(dataRow["DOB"]).ToString("yyyy-MM-dd")</td>
                            <td>@dataRow["FaceBookID"]</td>
                            <td>@dataRow["InstagramID"]</td>
                            <td>@dataRow["BloodGroup"]</td>
                            <td class="d-flex">
                                <a asp-controller="Contact" asp-action="ContactForm" asp-route-ContactID="@dataRow["ContactID"]" asp-route-stateID="@dataRow["StateID"]" asp-route-countryID="@dataRow["CountryID"]" class="btn btn-primary btn-sm" style="padding: 4px 8px; font-size: 13px; margin-right: 5px;">
                                    <i class="fa fa-pencil"></i>
                                </a>
                                <a asp-controller="Contact" asp-action="ContactDelete" asp-route-ContactID="@dataRow["ContactID"]" class="btn btn-danger btn-sm delete-button" style="padding: 4px 8px; font-size: 13px;">
                                    <i class="fa fa-times"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    /* Proper spacing and alignment for table fields */
    table {
        width: 100%;
        border-collapse: collapse;
    }

    th, td {
        padding: 12px 15px;
        text-align: left;
        vertical-align: middle;
        font-size: 14px;
    }

    th {
        background-color: #f9f9f9;
        font-weight: bold;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    /* Buttons spacing */
    .btn {
        margin: 2px;
    }

    .table-responsive {
        overflow-x: auto;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Search functionality
        const searchBox = document.getElementById("searchBox");
        const table = document.getElementById("sample_editable_1");
        const rows = table.querySelectorAll("tbody tr");

        searchBox.addEventListener("input", function () {
            const query = this.value.toLowerCase();

            rows.forEach(row => {
                const cells = row.querySelectorAll("td");
                const rowText = Array.from(cells)
                    .map(cell => cell.textContent.toLowerCase())
                    .join(" ");
                row.style.display = rowText.includes(query) ? "" : "none";
            });
        });

        // Delete button confirmation
        const deleteButtons = document.querySelectorAll(".delete-button");
        deleteButtons.forEach(button => {
            button.addEventListener("click", function (event) {
                event.preventDefault(); // Prevent immediate navigation
                const href = this.href; // Get the URL of the delete action

                Swal.fire({
                    title: "Are you sure?",
                    text: "You won't be able to revert this!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Redirect to the delete action
                        window.location.href = href;
                    }
                });
            });
        });
    });
</script>
