@using System.Data

<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <i class="icon-home"></i>
            <a asp-controller="Home" asp-action="Index">Home</a>
            <i class="fa fa-arrow-right"></i>
        </li>
        <li>
            <span>Country List</span>
        </li>
    </ul>
</div>
<!-- END PAGE BAR -->
@if (TempData["ErrorMsg"] != null)
{
    <div id="customToast" class="custom-toast">
        <span>@TempData["ErrorMsg"]</span>
        <button class="close-toast" onclick="closeToast()">×</button>
    </div>
}

@if (TempData["SuccessMsg"] != null)
{
    <div id="customToast1" class="custom-toast1">
        <span>@TempData["SuccessMsg"]</span>
        <button class="close-toast1" onclick="closeToast1()">×</button>
    </div>
}

<!-- Table begin -->
<div class="portlet light portlet-fit bordered" style="margin-top:10px">
    <div class="portlet-title d-flex justify-content-between">
        <div class="caption">
            <i class="icon-settings"></i>
            <span class="caption-subject sbold uppercase">Country List</span>
        </div>
        <div class="actions">
            <div class="btn-group btn-group-devided">
                <a asp-controller="Country" asp-action="CountryForm" class="btn green">
                    <i class="fa fa-plus"></i>
                    Add New
                </a>
                <a asp-controller="Country" asp-action="ExportToExcel" class="btn green">
                    Export to Excel
                </a>
            </div>
        </div>

    </div>
    <div class="portlet-body">
        <div class="table-toolbar">
            <div class="form-group col-md-3">
                <input type="text" id="searchBox" class="form-control" placeholder="Search Country...">
            </div>
        </div>
        <table class="table table-striped table-hover table-bordered" id="sample_editable_1">
            <thead>
                <tr>
                    <th>Country Name</th>
                    <th>Country Code</th>
                    <th>Country Capital</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (DataRow dataRow in Model.Rows)
                {
                    <tr>
                        <td>@dataRow["CountryName"]</td>
                        <td>@dataRow["CountryCode"]</td>
                        <td>@dataRow["CountryCapital"]</td>
                        <td class="d-flex">
                            @* <form method="post" asp-controller="Country" asp-action="CountryDelete">
                                <input type="hidden" value="@dataRow["CountryID"]" name="CountryID" />
                                <button class="btn btn-danger btn-sm" style="padding: 2px 6px; font-size: 12px;">
                                    <i class="fa fa-times"></i>
                                </button>
                            </form> *@
                            
                            <a asp-controller="Country" asp-action="CountryForm" asp-route-CountryID="@dataRow["CountryID"]" class="btn btn-primary btn-sm" style="padding: 2px 6px; font-size: 12px;">
                                <i class="fa fa-pencil"></i>
                            </a>
                            <a asp-controller="Country" asp-action="CountryDelete" asp-route-CountryID="@dataRow["CountryID"]" class="btn btn-danger btn-sm delete-button" style="padding: 2px 6px; font-size: 12px;">
                                <i class="fa fa-times"></i>
                            </a>
                        </td>

                    </tr>
                }

            </tbody>
        </table>
    </div>
</div>
<!-- Table End -->

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Search functionality
        const searchBox = document.getElementById("searchBox");
        const table = document.getElementById("sample_editable_1");
        const rows = table.querySelectorAll("tbody tr");

        searchBox.addEventListener("input", function () {
            const query = this.value.toLowerCase();

            rows.forEach(row => {
                const cells = row.querySelectorAll("td");
                const rowText = Array.from(cells)
                    .map(cell => cell.textContent.toLowerCase())
                    .join(" ");
                row.style.display = rowText.includes(query) ? "" : "none";
            });
        });
    });

        document.addEventListener("DOMContentLoaded", function () {
            const deleteButtons = document.querySelectorAll(".delete-button");
            deleteButtons.forEach(button => {
            button.addEventListener("click", function (event) {
                event.preventDefault(); // Prevent immediate navigation
                const href = this.href; // Get the URL of the delete action

                Swal.fire({
                    title: "Are you sure?",
                    text: "You won't be able to revert this!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Redirect to the delete action
                        window.location.href = href;
                    }
                });
            });
            });
        });
</script>
