@using System.Data
@using static addressbook_app.Controllers.ContactCategoryController

<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <i class="icon-home"></i>
            <a asp-controller="Home" asp-action="Index">Home</a>
            <i class="fa fa-arrow-right"></i>
        </li>
        <li>
            <span>ContactCategory List</span>
        </li>
    </ul>
</div>
<!-- END PAGE BAR -->
@if (TempData["ErrorMsg"] != null)
{
    <div id="customToast" class="custom-toast">
        <span>@TempData["ErrorMsg"]</span>
        <button class="close-toast" onclick="closeToast()">×</button>
    </div>
}

@if (TempData["SuccessMsg"] != null)
{
    <div id="customToast1" class="custom-toast1">
        <span>@TempData["SuccessMsg"]</span>
        <button class="close-toast1" onclick="closeToast1()">×</button>
    </div>
}

<!-- Table begin -->
<div class="portlet light portlet-fit bordered" style="margin-top:10px">
    <div class="portlet-title d-flex justify-content-between">
        <div class="caption">
            <i class="icon-settings"></i>
            <span class="caption-subject sbold uppercase">ContactCategory List</span>
        </div>
        <div class="actions">
            <div class="btn-group btn-group-devided">
                <a asp-controller="ContactCategory" asp-action="ContactCategoryForm" class="btn green">
                    <i class="fa fa-plus"></i>
                    Add New
                </a>
                <a asp-controller="ContactCategory" asp-action="ExportToExcel" class="btn green">
                    Export to Excel
                </a>
                <button id="deleteSelected" class="btn red">
                    <i class="fa fa-trash"></i>
                    Delete Selected
                </button>
            </div>
        </div>
    </div>
    <div class="portlet-body">
        <div class="table-toolbar">
            <div class="form-group col-md-3">
                <input type="text" id="searchBox" class="form-control" placeholder="Search ContactCategory...">
            </div>
        </div>
        <form id="deleteForm" asp-controller="ContactCategory" asp-action="DeleteMultiple" method="post">
            <table class="table table-striped table-hover table-bordered" id="sample_editable_1">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="selectAll" />
                        </th>
                        <th>ContactCategory Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (DataRow dataRow in Model.Rows)
                    {
                        <tr>
                            <td>
                                <input type="checkbox" name="selectedIds" value="@dataRow["ContactCategoryID"]" />
                            </td>
                            <td>@dataRow["ContactCategoryName"]</td>
                            <td class="d-flex">
                                <a asp-controller="ContactCategory" asp-action="ContactCategoryForm" asp-route-ContactCategoryID="@dataRow["ContactCategoryID"]" class="btn btn-primary btn-sm" style="padding: 2px 6px; font-size: 12px;">
                                    <i class="fa fa-pencil"></i>
                                </a>
                                <a asp-controller="ContactCategory" asp-action="ContactCategoryDelete" asp-route-ContactCategoryID="@dataRow["ContactCategoryID"]" class="btn btn-danger btn-sm delete-button" style="padding: 2px 6px; font-size: 12px;">
                                    <i class="fa fa-times"></i>
                                </a>
                            </td>
                        </tr>

                    }
                </tbody>
            </table>
        </form>
    </div>
</div>
<!-- Table End -->

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // "Select All" checkbox functionality
        const selectAll = document.getElementById("selectAll");
        const checkboxes = document.querySelectorAll("input[name='selectedIds']");

        selectAll.addEventListener("change", function () {
            checkboxes.forEach(checkbox => checkbox.checked = this.checked);
        });

        // Search functionality
        const searchBox = document.getElementById("searchBox");
        const table = document.getElementById("sample_editable_1");
        const rows = table.querySelectorAll("tbody tr");

        searchBox.addEventListener("input", function () {
            const query = this.value.toLowerCase();
            rows.forEach(row => {
                const cells = row.querySelectorAll("td");
                const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(" ");
                row.style.display = rowText.includes(query) ? "" : "none";
            });
        });

        // Bulk delete confirmation
        const deleteSelected = document.getElementById("deleteSelected");
        const deleteForm = document.getElementById("deleteForm");

        deleteSelected.addEventListener("click", function (event) {
            event.preventDefault();

            const selected = Array.from(checkboxes).filter(cb => cb.checked);
            if (selected.length === 0) {
                Swal.fire({
                    title: "No items selected",
                    text: "Please select at least one item to delete.",
                    icon: "warning",
                    confirmButtonText: "OK"
                });
                return;
            }

            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {
                    deleteForm.submit();
                }
            });
        });
    });
</script>